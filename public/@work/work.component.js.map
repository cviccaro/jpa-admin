{"version":3,"sources":["@work/work.component.ts"],"names":[],"mappings":"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","file":"@work/work.component.js","sourcesContent":["import {Component, OnInit} from '@angular/core';\nimport {ActivatedRoute, Router} from '@angular/router';\nimport {NgForm} from '@angular/common';\nimport { MD_ICON_DIRECTIVES } from '@angular2-material/icon';\n\nimport {FILE_UPLOAD_DIRECTIVES, FileUploader} from 'ng2-file-upload';\nimport {ToasterContainerComponent, ToasterService, ToasterConfig} from 'angular2-toaster';\n\nimport {WorkService, Work, ClientService} from '../shared/index';\n\nimport { Observable } from 'rxjs/Rx';\n\n@Component({\n    moduleId: module.id,\n    templateUrl: './work.component.html',\n    styleUrls: ['./work.component.css'],\n    directives: [FILE_UPLOAD_DIRECTIVES, MD_ICON_DIRECTIVES]\n})\nexport class WorkComponent implements OnInit {\n    public work: Work;\n    public clients: string[];\n    public uploader:FileUploader = new FileUploader({url: 'wtf'});\n    public hasBaseDropZoneOver: boolean = false;\n    //public toasterConfig: ToasterConfig;\n    private isNew: boolean = false;\n\n    constructor(\n        private route: ActivatedRoute,\n        private service: WorkService,\n        private clientService: ClientService,\n        private toasterService: ToasterService,\n        private router: Router\n    ) { }\n    \n    ngOnInit() {\n        console.log({\n            snapshot: this.route.snapshot,\n            params: this.route.snapshot.params,\n            id: this.route.snapshot.params['id']\n        });\n\n        this.clientService.options().subscribe(res => {\n            this.clients = res;\n        });\n\n        this.isNew = this.route.snapshot.params['id'] === 'new';\n\n        if (this.isNew) {\n            console.log('NEW: WorkComponent initialized.', this);\n            this.work = {\n                title: '',\n                body: '',\n                image: '',\n                client: {\n                    id: ''\n                }\n            };\n        } else {\n            let id = +this.route.snapshot.params['id'];\n\n            this.service.find(id).subscribe(res => {\n                this.work = res;\n            });\n\n            console.log('EDIT: WorkComponent initialized.', this);\n        }\n    }\n\n    onSubmit() {\n        if (this.uploader.queue.length) {\n            window['_files'] = this.uploader.queue;\n            console.log('Working through gallery queue with ' + this.uploader.queue.length + ' files', {\n                queue: this.uploader.queue\n            });\n\n            if (this.work.gallery_new === undefined) this.work.gallery_new = [];\n\n            let i = 0;\n            const length = this.uploader.queue.length;\n\n            this.uploader.queue.forEach(item => {\n                item._isLast = ++i === length;\n\n                this.readFile(item._file)\n                    .subscribe(file => {\n                        this.work.gallery_new.push(file);\n                        this.uploader.removeFromQueue(item);\n                        if (item._isLast) {\n                            this.save();\n                        }\n                    });\n            });\n\n            return;\n        }\n\n        this.save();\n    }\n\n    save() {\n        if (this.isNew) {\n            console.log('Save NEW work. ', this.work);\n            this.service.create(this.work)\n                .subscribe(res => {\n                    this.toasterService.pop('success', 'Success!', this.work.title + ' has been created.  Redirecting to its page.');\n                    setTimeout(() => {\n                        this.isNew = false;\n                        this.work = res;\n                        this.router.navigate(['/work', res.id]);\n                    }, 6000);\n                });\n        } else {\n            console.log('Save UPDATED work. ', this.work);\n            this.service.update(this.work.id, this.work)\n                .subscribe(res => {\n                    console.log('response from update: ', res);\n                    this.work = res;\n                    this.toasterService.pop('success', 'Success!', this.work.title + ' has been saved.');\n                });\n        }\n    }\n\n    ceil(a) {\n        return Math.ceil(a);\n    }\n\n    imageFieldChanged(e) {\n        let file = e.target.files[0];\n        const filename = file.name;\n\n        console.log('imageFieldChanged to ' + filename);\n\n        let reader = new FileReader();\n\n        reader.onload = readerEvt => {\n            let base64 = btoa(readerEvt.target['result']);\n\n            this.work.image_new = {\n                name: filename,\n                base64: base64\n            };\n        };\n\n        reader.readAsBinaryString(file);\n    }\n\n    readFile(file) : Observable<any> {\n        const filename = file.name;\n\n        return Observable.create(observer => {\n            let reader = new FileReader();\n\n            reader.onload = readerEvt => {\n                let base64 = btoa(readerEvt.target['result']);\n\n                observer.next({\n                    name: filename,\n                    base64: base64\n                });\n            };\n\n            reader.readAsBinaryString(file);\n        });\n    }\n\n    fileOverBase(e:any):void {\n      this.hasBaseDropZoneOver = e;\n    }\n}\n"],"sourceRoot":"/source/"}