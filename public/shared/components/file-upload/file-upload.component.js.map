{"version":3,"sources":["shared/components/file-upload/file-upload.component.ts"],"names":[],"mappings":"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","file":"shared/components/file-upload/file-upload.component.js","sourcesContent":["import {\n    forwardRef,\n    Component,\n    AfterViewInit,\n    AfterContentInit,\n    SimpleChange,\n    OnChanges,\n    Input,\n    Output,\n    HostListener,\n    EventEmitter,\n    ViewChildren,\n    ContentChildren,\n    Provider,\n    QueryList\n} from '@angular/core';\n\nimport { NgModel, ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { BooleanFieldValue } from '@angular2-material/core/annotations/field-value';\nimport { MD_GRID_LIST_DIRECTIVES, MdGridList } from '@angular2-material/grid-list';\nimport { MD_PROGRESS_BAR_DIRECTIVES } from '@angular2-material/progress-bar';\nimport { MD_ICON_DIRECTIVES } from '@angular2-material/icon';\nimport { Observable } from 'rxjs/Rx';\n\nimport {GridImage} from './grid-image/grid-image';\nimport { FileUploader } from './uploader';\n\nconst noop = () => { };\nlet nextUniqueId = 0;\n\nexport const JPA_FILE_UPLOAD_VALUE_ACCESSOR = new Provider(NG_VALUE_ACCESSOR, {\n    useExisting: forwardRef(() => JpaFileUploadComponent),\n    multi: true\n});\n\n@Component({\n    moduleId: module.id,\n    selector: 'jpa-file-upload',\n    templateUrl: './file-upload.component.html',\n    styleUrls: ['./file-upload.component.css'],\n    directives: [\n        MD_GRID_LIST_DIRECTIVES,\n        MD_PROGRESS_BAR_DIRECTIVES,\n        MD_ICON_DIRECTIVES,\n        NgModel,\n        GridImage\n    ],\n    providers: [JPA_FILE_UPLOAD_VALUE_ACCESSOR, FileUploader]\n})\nexport class JpaFileUploadComponent implements AfterViewInit, OnChanges, ControlValueAccessor {\n    public isDragOver: boolean = false;\n    public isLoading: boolean = false;\n    public loading: { [key: number] : any}\n    private _progressIndeterminate: boolean = true;\n\n    private _hasNew: boolean = false;\n    private _added: number = 0;\n\n    /** number of images initially fed into images input **/\n    private _count: number = 0;\n    private _galleryImagesLoaded:number = 0;\n\n    private _value: File[] = [];\n\n    /** Callback registered via registerOnTouched (ControlValueAccessor) */\n    private _onTouchedCallback: () => void = noop;\n    /** Callback registered via registerOnChange (ControlValueAccessor) */\n    private _onChangeCallback: (_: any) => void = (...args) => {\n        console.debug('JpaFileUploadComponent#onChangeCallback:', args);\n    };\n\n    constructor(public uploader: FileUploader) {\n        console.debug('FileUploadComponent created! ', this);\n    }\n\n    /**\n     * Aria related inputs.\n     */\n    @Input('aria-label') ariaLabel: string;\n    @Input('aria-labelledby') ariaLabelledBy: string;\n    @Input('aria-disabled') @BooleanFieldValue() ariaDisabled: boolean;\n    @Input('aria-required') @BooleanFieldValue() ariaRequired: boolean;\n    @Input('aria-invalid') @BooleanFieldValue() ariaInvalid: boolean;\n\n    /**\n     * Inputs\n     */\n    @Input() @BooleanFieldValue() multiple: boolean = false;\n    @Input() images: any[] = [];\n    @Input() name: string = null;\n\n    @Input() id: string = `jpa-panel-${nextUniqueId++}`;\n    @Input() @BooleanFieldValue() required: boolean = false;\n    @Input() step: number = null;\n    @Input() tabIndex: number = null;\n\n    /**\n     * Outputs\n     */\n    @Output() fileAdded: EventEmitter<File[]> = new EventEmitter<File[]>();\n    @Output() gridImageLoaded = new EventEmitter();\n    @Output() onImageUploaded = new EventEmitter();\n    @Output() onImageRemove = new EventEmitter();\n\n\n    /**\n     * Content directives\n     */\n    @ViewChildren(GridImage) private _gridImages: QueryList<GridImage>;\n\n    /**\n     * Host bindings\n     */\n    onDragOver(e: any) {\n        let transfer = this._getTransfer(e);\n        if (!this._haveFiles(transfer.types)) {\n            return;\n        }\n        transfer.dropEffect = 'copy';\n        this._stopEvent(e);\n        this.isDragOver = true;\n    }\n\n    onDragLeave(e: any) {\n        this._stopEvent(e);\n        this.isDragOver = false;\n    }\n\n    onFileDrop(e: any) {\n        let files = e.target.files || e.dataTransfer.files;\n        this._stopEvent(e);\n        this.isDragOver = false;\n        this.fileAdded.emit(files);\n        this.isLoading = true;\n\n        for (let i = 0; i < files.length; i++) {\n            let file = files[i];\n\n            let reader = new FileReader();\n            let k = i;\n\n            this.isLoading = true;\n            reader.addEventListener('load', e => {\n                let filename = file.name;\n                let newImage = {id: 'new', name: filename, image_url: reader.result, isNew: true};\n                console.log('Loaded new image: ', newImage);\n                this.images.push(newImage);\n                let value = this.value;\n                value.push(newImage);\n                this.value = value;\n            });\n\n            setTimeout(() => { reader.readAsDataURL(file); });\n        }\n\n        console.log('FileUploadComponent#FileDrop', {\n            e: e,\n            this: this\n        });\n    }\n\n    private _blurEmitter: EventEmitter<FocusEvent> = new EventEmitter<FocusEvent>();\n    private _focusEmitter: EventEmitter<FocusEvent> = new EventEmitter<FocusEvent>();\n\n    @Output('blur')\n    get onBlur(): Observable<FocusEvent> {\n        return this._blurEmitter.asObservable();\n    }\n\n    @Output('focus')\n    get onFocus(): Observable<FocusEvent> {\n        return this._focusEmitter.asObservable();\n    }\n\n    @Output() change = new EventEmitter();\n\n    /** @internal */\n    handleFocus(event: FocusEvent) {\n        console.log('FileUploadComponent#handleFocus', event);\n    }\n\n    /** @internal */\n    handleBlur(event: FocusEvent) {\n        console.log('FileUploadComponent#handleBlur', event);\n    }\n\n    /**\n     * Lifecycle\n     */\n\n    ngOnInit() {\n        if (this.images === undefined) {\n            this.isLoading = false;\n            this._count = 0;\n        } else {\n            this.isLoading = !!this.images.length;\n            this._count = this.images.length;\n        }\n    }\n\n    ngAfterViewInit() {\n        console.info('FileUploadComponent#AfterViewInit ---', this);\n\n        if (this._gridImages) {\n            console.log('got grid images: ', this._gridImages);\n            this._gridImages.changes.subscribe( (changes: QueryList<GridImage>) => {\n                console.log('Changes to grid images: ', changes);\n            });\n        }\n    }\n\n    ngOnChanges(changes: { [key: string]: SimpleChange }) {\n        console.debug('FileUploadComponent#OnChanges ---', changes);\n    }\n\n\n    /**\n       * Implemented as part of ControlValueAccessor.\n       */\n    writeValue(value: any) {\n        console.log('FileUploadComponent#writeValue?');\n\n        if (value !== undefined) {\n            this._value = value;\n            console.log('FileUploadComponent#writeValue COMMIT TO ', value);\n        } else {\n            this._value = [];\n            console.log('just set value to ...', {\n                value: this._value\n            });\n        }\n\n        //if (!this._initialValue) this._initialValue = value;\n    }\n\n    get value(): any { return this._value; };\n    @Input() set value(v: any) {\n        console.debug('FileUploadComponent# set value(): ', {\n            v: v,\n            _value: this._value\n        });\n        if (v.length !== this._added) {\n            this._added++;\n            this._value = v;\n            console.warn('emitting change', v);\n            this.change.emit(v);\n        }\n    }\n\n    /**\n     * Implemented as part of ControlValueAccessor.\n     */\n    registerOnChange(fn: any) {\n        this._onChangeCallback = fn;\n    }\n\n    /**\n     * Implemented as part of ControlValueAccessor.\n     */\n    registerOnTouched(fn: any) {\n        this._onTouchedCallback = fn;\n    }\n\n    private _isArray(a) {\n        return Array.isArray(a) && a.length;\n    }\n\n    /** internal */\n    private _stopEvent(e: Event) {\n        event.preventDefault();\n        event.stopPropagation();\n    }\n\n    /** internal */\n    private _getTransfer(event: any): any {\n        return event.dataTransfer ? event.dataTransfer : event.originalEvent.dataTransfer; // jQuery fix;\n    }\n\n    /** internal */\n    private _haveFiles(types: any): any {\n        if (!types) {\n            return false;\n        }\n\n        if (types.indexOf) {\n            return types.indexOf('Files') !== -1;\n        } else if (types.contains) {\n            return types.contains('Files');\n        } else {\n            return false;\n        }\n    }\n\n\n    imageLoaded(e: any) {\n        if (e.config.id === 'new') {\n            console.log('FileUpload# new Image loaded. ', {\n                e: e,\n                value: this.value\n            });\n            this._hasNew = true;\n            this.isLoading = false;\n            e._hasNew = true;\n            this.onImageUploaded.emit(e);\n        } else {\n            let id = e.config.id;\n            console.log('FileUpload# gallery Image (id '+id+') loaded. ', e);\n\n            if (++this._galleryImagesLoaded === this.images.length) {\n                this.isLoading = false;\n            }\n        }\n\n        e._hasNew = this._hasNew;\n        this.gridImageLoaded.emit(e);\n    }\n\n    imageRemoved(e: any) {\n        console.log('FileUpload # image Removed', {\n            e: e,\n            value: this.value\n        });\n        this.images.splice(e.index, 1);\n\n        if (this.value && this.value.length) {\n            let idx = this.value.indexOf(e.config);\n            if (idx !== -1) {\n                this.value.splice(idx, 1);\n            }\n        }\n        this.onImageRemove.emit(e);\n    }\n}\n"],"sourceRoot":"/source/"}