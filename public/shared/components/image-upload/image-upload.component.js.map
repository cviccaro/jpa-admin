{"version":3,"sources":["shared/components/image-upload/image-upload.component.ts"],"names":[],"mappings":"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","file":"shared/components/image-upload/image-upload.component.js","sourcesContent":["import {\r\n    forwardRef,\r\n    Component,\r\n    AfterViewInit,\r\n    AfterContentInit,\r\n    SimpleChange,\r\n    OnChanges,\r\n    Input,\r\n    Output,\r\n    HostListener,\r\n    EventEmitter,\r\n    ViewChild,\r\n    ViewChildren,\r\n    ContentChildren,\r\n    Provider,\r\n    QueryList\r\n} from '@angular/core';\r\n\r\nimport { NgModel, ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\nimport { BooleanFieldValue } from '@angular2-material/core/annotations/field-value';\r\nimport { MD_GRID_LIST_DIRECTIVES, MdGridList } from '@angular2-material/grid-list';\r\n\r\nimport { MD_PROGRESS_BAR_DIRECTIVES } from '@angular2-material/progress-bar';\r\nimport { MD_ICON_DIRECTIVES } from '@angular2-material/icon';\r\nimport { Observable } from 'rxjs/Rx';\r\n\r\nimport { GridImage, ImageUpload } from './grid-image/index';\r\nimport { JpImage } from '../../models/jp-image';\r\n\r\nimport { DND_DIRECTIVES } from 'ng2-dnd/ng2-dnd';\r\n\r\nimport { AuthService } from '../../services/auth.service';\r\n\r\nconst noop = () => { };\r\nlet nextUniqueId = 0;\r\n\r\nexport const IMAGE_UPLOAD_VALUE_ACCESSOR = new Provider(NG_VALUE_ACCESSOR, {\r\n    useExisting: forwardRef(() => ImageUploadComponent),\r\n    multi: true\r\n});\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: 'jpa-image-upload',\r\n    templateUrl: './image-upload.component.html',\r\n    styleUrls: ['./image-upload.component.css'],\r\n    directives: [\r\n        MD_GRID_LIST_DIRECTIVES,\r\n        MD_PROGRESS_BAR_DIRECTIVES,\r\n        MD_ICON_DIRECTIVES,\r\n        NgModel,\r\n        GridImage,\r\n        DND_DIRECTIVES\r\n    ],\r\n    providers: [IMAGE_UPLOAD_VALUE_ACCESSOR]\r\n})\r\nexport class ImageUploadComponent implements OnChanges, ControlValueAccessor {\r\n    public isDragOver: boolean = false;\r\n    public isLoading: boolean = false;\r\n\r\n    private _imagesLoaded:number = 0;\r\n    private _value: File[] = [];\r\n\r\n    private _rows: any[] = [];\r\n    private _cols: any[] = [];\r\n    private _draggingImage: boolean = false;\r\n    private _dragImage: any;\r\n    private _dropZoneStart: number;\r\n    private _droppedImage: any;\r\n\r\n    private _onTouchedCallback: () => void = noop;\r\n    private _onChangeCallback: (_: any) => void = noop;\r\n\r\n\r\n    /**\r\n     * Content directives\r\n     */\r\n    @ViewChildren(GridImage) private _gridImages: QueryList<GridImage>;\r\n    @ViewChild(MdGridList) private _gridList: MdGridList;\r\n\r\n    /**\r\n     * Inputs\r\n     */\r\n    @Input() @BooleanFieldValue() multiple: boolean = false;\r\n    @Input() images: any[] = [];\r\n\r\n    // MdGridList\r\n    @Input() gutterSize: string = \"8px\";\r\n    @Input() cols: number = 4;\r\n    @Input() rowHeight: any = '16:9';\r\n\r\n    // form-related\r\n    @Input() name: string = null;\r\n    @Input() @BooleanFieldValue() required: boolean = false;\r\n    @Input() id: string = `jpa-panel-${nextUniqueId++}`;\r\n    @Input() step: number = null;\r\n    @Input() tabIndex: number = null;\r\n\r\n    /**\r\n     * Outputs\r\n     */\r\n    @Output() fileAdded: EventEmitter<File[]> = new EventEmitter<File[]>();\r\n    @Output() imageLoaded = new EventEmitter();\r\n    @Output() imageAdded = new EventEmitter();\r\n    @Output() imageRemoved = new EventEmitter();\r\n    @Output() change = new EventEmitter();\r\n\r\n    /** element  outputs **/\r\n    private _blurEmitter: EventEmitter<FocusEvent> = new EventEmitter<FocusEvent>();\r\n    private _focusEmitter: EventEmitter<FocusEvent> = new EventEmitter<FocusEvent>();\r\n\r\n    @Output('blur')\r\n    get onBlur(): Observable<FocusEvent> {\r\n        return this._blurEmitter.asObservable();\r\n    }\r\n\r\n    @Output('focus')\r\n    get onFocus(): Observable<FocusEvent> {\r\n        return this._focusEmitter.asObservable();\r\n    }\r\n\r\n    /** @internal */\r\n    handleFocus(event: FocusEvent) {\r\n        console.log('ImageUploadComponent#handleFocus', event);\r\n    }\r\n\r\n    /** @internal */\r\n    handleBlur(event: FocusEvent) {\r\n        console.log('ImageUploadComponent#handleBlur', event);\r\n    }\r\n\r\n    /**\r\n     * Lifecycle\r\n     */\r\n    constructor(authService: AuthService) { }\r\n\r\n    ngOnChanges(changes: { [key: string]: SimpleChange }) {\r\n        console.debug('ImageUploadComponent#OnChanges ---', changes);\r\n    }\r\n\r\n    /**\r\n     * Grid interaction events\r\n     */\r\n    onDragOver(e: any) {\r\n        if (this._draggingImage) {\r\n            return;\r\n        }\r\n\r\n        let transfer = this._getTransfer(e);\r\n        if (!this._haveFiles(transfer.types)) {\r\n            return;\r\n        }\r\n        transfer.dropEffect = 'copy';\r\n        this._stopEvent(e);\r\n        this.isDragOver = true;\r\n    }\r\n\r\n    onDragLeave(e: any) {\r\n        if (this._draggingImage) {\r\n            return;\r\n        }\r\n\r\n        this._stopEvent(e);\r\n        this.isDragOver = false;\r\n    }\r\n\r\n    onFileDrop(e: any) {\r\n        if (this._draggingImage) {\r\n            console.log('onFileDrop cancelling because we are dragging image.');\r\n            this._draggingImage = false;\r\n            return;\r\n        } else {\r\n            console.log('onFileDrop ', e);\r\n            let files = e.target.files || e.dataTransfer.files;\r\n\r\n            this._stopEvent(e);\r\n            this.fileAdded.emit(files);\r\n\r\n            this.isDragOver = false;\r\n            this.isLoading = true;\r\n\r\n            this.readFiles(files);\r\n        }\r\n        console.log('ImageUploadComponent#FileDrop', {\r\n            e: e,\r\n            this: this\r\n        });\r\n    }\r\n\r\n    readFiles(files) {\r\n        let count = this.value.length;\r\n\r\n        for (let i = 0; i < files.length; i++) {\r\n            let file = files[i];\r\n\r\n            let image = new ImageUpload(file);\r\n            let reader = new FileReader();\r\n\r\n            this.isLoading = true;\r\n\r\n            reader.addEventListener('load', e => {\r\n                image.url = reader.result;\r\n                this.addImageToGrid(image);\r\n                this.isLoading = false;\r\n            });\r\n\r\n            setTimeout(() => { reader.readAsDataURL(file); });\r\n        }\r\n    }\r\n\r\n    addImageToGrid(image) {\r\n        console.log('Loaded new image: ', image);\r\n\r\n        let value = this.value;\r\n        value.push(image);\r\n        this.value = value;\r\n\r\n        this.imageAdded.emit(image);\r\n    }\r\n\r\n    /**\r\n     * NgControl value\r\n     */\r\n\r\n     get value(): any { return this._value; };\r\n     @Input() set value(v: any) {\r\n         console.debug('ImageUploadComponent# set value(): ', {\r\n             v: v,\r\n             _value: this._value\r\n         });\r\n         if (v !== this._value) {\r\n             this._value = v;\r\n             console.warn('emitting change', v);\r\n             //this.change.emit(v);\r\n             this._onChangeCallback(v);\r\n             //this.setCounts();\r\n         }\r\n\r\n         this._onChangeCallback(v);\r\n     }\r\n\r\n    /**\r\n     * ControlValueAccessor implementation\r\n     */\r\n    writeValue(value: any) {\r\n        this._value = value || [];\r\n        console.debug('ImageUpload#writeValue: ', {value: this._value});\r\n    }\r\n    registerOnChange(fn: any) {\r\n        this._onChangeCallback = fn;\r\n    }\r\n    registerOnTouched(fn: any) {\r\n        this._onTouchedCallback = fn;\r\n    }\r\n\r\n    /** internal */\r\n    private _stopEvent(e: Event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n    }\r\n\r\n    /** internal */\r\n    private _getTransfer(event: any): any {\r\n        return event.dataTransfer ? event.dataTransfer : event.originalEvent.dataTransfer;\r\n    }\r\n\r\n    /** internal */\r\n    private _haveFiles(types: any): any {\r\n        if (!types) {\r\n            return false;\r\n        }\r\n\r\n        if (types.indexOf) {\r\n            return types.indexOf('Files') !== -1;\r\n        } else if (types.contains) {\r\n            return types.contains('Files');\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    handleImageLoaded(e: any) {\r\n        e._hasNew = false;\r\n\r\n        if (!e.config.hasOwnProperty('id')) {\r\n            this.isLoading = false;\r\n\r\n            e._hasNew = true;\r\n        } else {\r\n            let id = e.config.id;\r\n\r\n            if (++this._imagesLoaded === this.value.length) {\r\n                this.isLoading = false;\r\n            }\r\n        }\r\n\r\n        this.imageLoaded.emit(e);\r\n    }\r\n\r\n    handleClickedRemove(e: any) {\r\n        console.debug('ImageUpload.handleClickedRemove', {\r\n            e: e,\r\n            value: this.value\r\n        });\r\n\r\n        let value = this.value;\r\n        value.splice(e.index, 1);\r\n        this.value = value;\r\n\r\n        this.imageRemoved.emit(e);\r\n    }\r\n\r\n    /**\r\n     * Drag and drop grid images to reorder\r\n     */\r\n\r\n    private _dragData(image: JpImage, idx: number): JpImage {\r\n        return Object.assign(image, {idx: idx})\r\n    }\r\n\r\n    imageDragStart(e: any): void {\r\n        this._dropZoneStart = e.dragData.idx;\r\n        this._draggingImage = true;\r\n        this._dragImage = e.dragData;\r\n        console.debug('ImageUpload imageDragStart  from zone ' + this._dropZoneStart + ': ', e);\r\n    }\r\n\r\n    imageDropped(event: any, image: JpImage, zone: number): void {\r\n        console.info('ImageUpload image dropped', {\r\n            event: event,\r\n            image: image,\r\n            zone: zone\r\n        });\r\n        this._draggingImage = false;\r\n        this._dragImage = null;\r\n\r\n        let data = event.dragData;\r\n\r\n        if (this._dropZoneStart !== zone) {\r\n            this.moveImage(this._dropZoneStart, zone);\r\n        }\r\n    }\r\n\r\n    onDragEnd(e: any) {\r\n        console.debug('onDragEnd');\r\n        this._draggingImage = false;\r\n    }\r\n\r\n    moveImage(old_index, new_index): void {\r\n        let images = this.value;\r\n\r\n        const source = images[old_index];\r\n        const target = images[new_index];\r\n\r\n        images[new_index] = source;\r\n        images[old_index] = target;\r\n\r\n        this.value = images;\r\n\r\n        this.change.emit(this.value);\r\n        this._onChangeCallback(this.value);\r\n\r\n        console.log('Just dropped image from drop zone ' + this._dropZoneStart + ' to drop zone ' + new_index);\r\n    };\r\n\r\n    /**\r\n     * Form reset\r\n     */\r\n    reset() {\r\n\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}