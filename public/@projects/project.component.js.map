{"version":3,"sources":["@projects/project.component.ts"],"names":[],"mappings":"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","file":"@projects/project.component.js","sourcesContent":["import {\r\n    AfterViewInit,\r\n    AfterViewChecked,\r\n    AfterContentChecked,\r\n    AfterContentInit,\r\n    Component,\r\n    HostBinding,\r\n    OnInit,\r\n    QueryList,\r\n    ViewChild,\r\n    ViewChildren,\r\n    ContentChildren\r\n} from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Observable } from 'rxjs/Rx';\r\nimport { NgForm, FormControl, FormControlDirective } from '@angular/forms';\r\nimport { MATERIAL_DIRECTIVES } from '../shared/libs/angular2-material';\r\nimport { ToasterContainerComponent, ToasterService, ToasterConfig } from 'angular2-toaster';\r\n\r\nimport {\r\n    ClientService,\r\n    ImageUpload,\r\n    JpaMdSelectComponent,\r\n    JpaPanel,\r\n    JpaPanelGroup,\r\n    JpaPanelContent,\r\n    JpClient,\r\n    JpFile,\r\n    ProjectService,\r\n    Project,\r\n    JpaCache\r\n} from '../shared/index';\r\n\r\nimport {\r\n    PANEL2_DIRECTIVES,\r\n    PanelFormControl,\r\n    PanelFormControlTextfield,\r\n    PanelFormControlSelect,\r\n    PanelFormControlTextarea,\r\n    PanelFormControlDragnDrop,\r\n    PanelFormControlFiles\r\n} from '../shared/index';\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    templateUrl: './project.component.html',\r\n    styleUrls: ['./project.component.css'],\r\n    directives: [\r\n        MATERIAL_DIRECTIVES,\r\n        JpaMdSelectComponent,\r\n        JpaPanel,\r\n        JpaPanelGroup,\r\n        JpaPanelContent,\r\n        PANEL2_DIRECTIVES,\r\n        NgForm\r\n    ]\r\n})\r\nexport class ProjectComponent implements OnInit, AfterViewInit {\r\n    public clients: { label: string, value: any }[];\r\n    public ready: boolean = false;\r\n    public submitted = false;\r\n\r\n    private _originalTitle: string;\r\n    private _isNew: boolean = false;\r\n    private _project: Project = new Project();\r\n    private _projectImage: JpFile = undefined;\r\n\r\n    public controls: PanelFormControl<any>[];\r\n\r\n\r\n    @HostBinding('class.new') get isNewClass() { return this._isNew; }\r\n\r\n    @ViewChildren(JpaPanel) private _panelChildren: QueryList<JpaPanel>;\r\n    @ContentChildren(FormControl) private _controls: QueryList<FormControl>;\r\n    @ViewChildren(FormControl) private _controlsView: QueryList<FormControl>;\r\n    @ContentChildren(FormControlDirective) private _controlsDir: QueryList<FormControlDirective>;\r\n    @ViewChildren(FormControlDirective) private _controlsDirView: QueryList<FormControlDirective>;\r\n    @ViewChild(NgForm) private _form: NgForm;\r\n\r\n    constructor(\r\n        private route: ActivatedRoute,\r\n        private service: ProjectService,\r\n        private clientService: ClientService,\r\n        private toasterService: ToasterService,\r\n        private router: Router,\r\n        private cache: JpaCache\r\n    ) {\r\n\r\n    }\r\n\r\n    get project(): Project { return this._project; }\r\n    set project(v: Project) {\r\n        this._project = v;\r\n        // this.setup();\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.clients = this.cache.get('clients');\r\n\r\n        if (this.route.snapshot.params['id'] === 'new') {\r\n            this.ready = true;\r\n            this._isNew = true;\r\n        } else {\r\n            // this.project = this.cache.get('project');\r\n            // this.ready = true;\r\n\r\n            this.service.find(+this.route.snapshot.params['id']).subscribe(res => {\r\n                this.project = res;\r\n                console.debug('setting project model to ', res);\r\n                this.ready = true;\r\n            });\r\n        }\r\n\r\n        this.controls = [\r\n          new PanelFormControlTextfield({\r\n            name: 'title',\r\n            required: true,\r\n            order: 3\r\n          }),\r\n          new PanelFormControlSelect({\r\n              name: 'client_id',\r\n              label: 'Client',\r\n              required: true,\r\n              options: this.clients\r\n          }),\r\n          new PanelFormControlTextarea({\r\n              name: 'description',\r\n              required: true,\r\n              ckeditor: true\r\n          }),\r\n          new PanelFormControlFiles({\r\n              name: 'image',\r\n              label: 'Cover Image',\r\n              required: true,\r\n              multiple: false,\r\n              type: 'image'\r\n          }),\r\n          new PanelFormControlFiles({\r\n              name: 'images',\r\n              required: false,\r\n              multiple: true,\r\n              filesLabel: 'images in gallery',\r\n              type: 'image'\r\n          })\r\n        ];\r\n\r\n        console.info('ProjectComponent#'+(this._isNew?'create':'edit')+' initialized.', this);\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n        console.info('ProjectComponent#'+(this._isNew?'create':'edit')+' View Initialized.', this);\r\n    }\r\n\r\n    onSubmit() {\r\n        this.submitted = true;\r\n        if (this._isNew) {\r\n            console.log('Save NEW project. ', this.project);\r\n            this.service.create(this.project)\r\n                .subscribe(res => {\r\n                    this.toasterService.pop('success', 'Success!', this.project.title + ' has been created.  Redirecting to its page.');\r\n                    setTimeout(() => {\r\n                        this.project = res;\r\n                        console.log(\"Navigating to /projects/\" + res.id);\r\n                        this.router.navigate(['/projects', res.id]);\r\n                        this.reset();\r\n                    }, 2000);\r\n                },err => {\r\n                    console.log('Error when saving projet: ', err);\r\n                    this.toasterService.pop('error', 'Uh oh.', 'Something went wrong when saving this project.  Sorry.  Try again later and/or alert the developer!');\r\n                });\r\n        } else {\r\n            console.log('Save UPDATED project. ', this.project);\r\n            this.service.update(this.project.id, this.project)\r\n                .subscribe(res => {\r\n                    console.log('response from update: ', res);\r\n                    this.project = res;\r\n                    this.reset();\r\n                    this.toasterService.pop('success', 'Success!', this.project.title + ' has been saved.');\r\n                }, err => {\r\n                    console.log('Error when saving projet: ', err);\r\n                    this.toasterService.pop('error', 'Uh oh.', 'Something went wrong when saving this project.  Sorry.  Try again later and/or alert the developer!');\r\n                });\r\n        }\r\n    }\r\n\r\n    private setup() {\r\n        this._projectImage = this._project.image;\r\n        this._project.image = null;\r\n        this._originalTitle = this._project.title;\r\n        this._isNew = this.project.id === undefined;\r\n        console.info('ProjectComponent.setup()', this);\r\n    }\r\n\r\n    private reset(e?:Event) {\r\n        if (e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n        }\r\n        console.info('ProjectComponent.reset()', this);\r\n\r\n        // this._panelChildren.forEach(panel => {\r\n        //     panel.reset();\r\n        // });\r\n\r\n        // Temporary workaround until angular2 implements\r\n        // a proper form reset\r\n        this.ready = false;\r\n\r\n        setTimeout(() => { this.ready = true; },0);\r\n    }\r\n\r\n    report(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        console.log(this.project);\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}